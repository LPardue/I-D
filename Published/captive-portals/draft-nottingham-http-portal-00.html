<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html lang="en"><head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/"><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"><title>Considerations for Captive Portals in HTTP</title><style type="text/css" title="Xml2Rfc (sans serif)">
a {
  text-decoration: none;
}
a.smpl {
  color: black;
}
a:hover {
  text-decoration: underline;
}
a:active {
  text-decoration: underline;
}
address {
  margin-top: 1em;
  margin-left: 2em;
  font-style: normal;
}
body {
  color: black;
  font-family: verdana, helvetica, arial, sans-serif;
  font-size: 10pt;
}
cite {
  font-style: normal;
}
dd {
  margin-right: 2em;
}
dl {
  margin-left: 2em;
}

dl.empty dd {
  margin-top: .5em;
}
dl p {
  margin-left: 0em;
}
dt {
  margin-top: .5em;
}
h1 {
  font-size: 14pt;
  line-height: 21pt;
  page-break-after: avoid;
}
h1.np {
  page-break-before: always;
}
h1 a {
  color: #333333;
}
h2 {
  font-size: 12pt;
  line-height: 15pt;
  page-break-after: avoid;
}
h3, h4, h5, h6 {
  font-size: 10pt;
  page-break-after: avoid;
}
h2 a, h3 a, h4 a, h5 a, h6 a {
  color: black;
}
img {
  margin-left: 3em;
}
li {
  margin-left: 2em;
  margin-right: 2em;
}
ol {
  margin-left: 2em;
  margin-right: 2em;
}
ol p {
  margin-left: 0em;
}
p {
  margin-left: 2em;
  margin-right: 2em;
}
pre {
  margin-left: 3em;
  background-color: lightyellow;
  padding: .25em;
}
pre.text2 {
  border-style: dotted;
  border-width: 1px;
  background-color: #f0f0f0;
  width: 69em;
}
pre.inline {
  background-color: white;
  padding: 0em;
}
pre.text {
  border-style: dotted;
  border-width: 1px;
  background-color: #f8f8f8;
  width: 69em;
}
pre.drawing {
  border-style: solid;
  border-width: 1px;
  background-color: #f8f8f8;
  padding: 2em;
}
table {
  margin-left: 2em;
}
table.header {
  width: 95%;
  font-size: 10pt;
  color: white;
}
td.top {
  vertical-align: top;
}
td.topnowrap {
  vertical-align: top;
  white-space: nowrap; 
}
td.header {
  background-color: gray;
  width: 50%;
}
td.header a {
  color: white;
}
td.reference {
  vertical-align: top;
  white-space: nowrap;
  padding-right: 1em;
}
thead {
  display:table-header-group;
}
ul.toc {
  list-style: none;
  margin-left: 1.5em;
  margin-right: 0em;
  padding-left: 0em;
}
li.tocline0 {
  line-height: 150%;
  font-weight: bold;
  font-size: 10pt;
  margin-left: 0em;
  margin-right: 0em;
}
li.tocline1 {
  line-height: normal;
  font-weight: normal;
  font-size: 9pt;
  margin-left: 0em;
  margin-right: 0em;
}
li.tocline2 {
  font-size: 0pt;
}
ul p {
  margin-left: 0em;
}

.comment {
  background-color: yellow;
}
.center {
  text-align: center;
}
.error {
  color: red;
  font-style: italic;
  font-weight: bold;
}
.figure {
  font-weight: bold;
  text-align: center;
  font-size: 9pt;
}
.filename {
  color: #333333;
  font-weight: bold;
  font-size: 12pt;
  line-height: 21pt;
  text-align: center;
}
.fn {
  font-weight: bold;
}
.hidden {
  display: none;
}
.left {
  text-align: left;
}
.right {
  text-align: right;
}
.title {
  color: #990000;
  font-size: 18pt;
  line-height: 18pt;
  font-weight: bold;
  text-align: center;
  margin-top: 36pt;
}
.vcardline {
  display: block;
}
.warning {
  font-size: 14pt;
  background-color: yellow;
}


@media print {
  .noprint {
    display: none;
  }
  
  a {
    color: black;
    text-decoration: none;
  }

  table.header {
    width: 90%;
  }

  td.header {
    width: 50%;
    color: black;
    background-color: white;
    vertical-align: top;
    font-size: 12pt;
  }

  ul.toc a::after {
    content: leader('.') target-counter(attr(href), page);
  }
  
  a.iref {
    content: target-counter(attr(href), page);
  }
  
  .print2col {
    column-count: 2;
    -moz-column-count: 2;
    column-fill: auto;
  }
}

@page {
  @top-left {
       content: "INTERNET DRAFT"; 
  } 
  @top-right {
       content: "August 2010"; 
  } 
  @top-center {
       content: "HTTP Captive Portals"; 
  } 
  @bottom-left {
       content: "Nottingham"; 
  } 
  @bottom-center {
       content: "Informational"; 
  } 
  @bottom-right {
       content: "[Page " counter(page) "]"; 
  } 
}

@page:first { 
    @top-left {
      content: normal;
    }
    @top-right {
      content: normal;
    }
    @top-center {
      content: normal;
    }
}
</style><link rel="Contents" href="#rfc.toc"><link rel="Author" href="#rfc.authors"><link rel="Copyright" href="#rfc.copyright"><link rel="Chapter" title="1 Introduction" href="#rfc.section.1"><link rel="Chapter" title="2 HTTP Issues Encountered" href="#rfc.section.2"><link rel="Chapter" title="3 Proposal" href="#rfc.section.3"><link rel="Chapter" title="4 What about Non-HTTP Applications and Techniques?" href="#rfc.section.4"><link rel="Chapter" title="5 Security Considerations" href="#rfc.section.5"><link rel="Chapter" title="6 IANA Considerations" href="#rfc.section.6"><link rel="Appendix" title="A Acknowledgements" href="#rfc.section.A"><meta name="generator" content="http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.478, 2009-10-16 14:30:15, XSLT vendor: SAXON 8.9 from Saxonica http://www.saxonica.com/"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.Creator" content="Nottingham, M."><meta name="DC.Identifier" content="urn:ietf:id:draft-nottingham-http-portal-00"><meta name="DC.Date.Issued" scheme="ISO8601" content="2010-08-05"><meta name="DC.Description.Abstract" content="&#34;Captive portals&#34; are a commonly-deployed means of obtaining access credentials and/or payment for a network. This memo discusses issues of their use for HTTP applications, and proposes one possible mitigation strategy.This memo should be discussed on the ietf-http-wg@w3.org mailing list, although it is not a work item of the HTTPbis WG."><meta name="description" content="&#34;Captive portals&#34; are a commonly-deployed means of obtaining access credentials and/or payment for a network. This memo discusses issues of their use for HTTP applications, and proposes one possible mitigation strategy.This memo should be discussed on the ietf-http-wg@w3.org mailing list, although it is not a work item of the HTTPbis WG."></head><body><table class="header" border="0" cellpadding="1" cellspacing="1"><tr><td class="header left">Network Working Group</td><td class="header right">M. Nottingham</td></tr><tr><td class="header left">Internet Draft</td><td class="header right">August 5, 2010</td></tr><tr><td class="header left">
        &lt;draft-nottingham-http-portal-00&gt;
      </td><td class="header right"></td></tr><tr><td class="header left">Intended status: Informational</td><td class="header right"></td></tr><tr><td class="header left">Expires: February 6, 2011</td><td class="header right"></td></tr></table><p class="title">Considerations for Captive Portals in HTTP<br><span class="filename">draft-nottingham-http-portal-00</span></p><h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1><p>"Captive portals" are a commonly-deployed means of obtaining access credentials and/or payment for a network. This memo discusses issues of their use for HTTP applications, and proposes one possible mitigation strategy.</p><p>This memo should be discussed on the ietf-http-wg@w3.org mailing list, although it is not a work item of the HTTPbis WG.</p><h1><a id="rfc.status" href="#rfc.status">Status of this Memo</a></h1><p>This Internet-Draft is submitted to IETF in full conformance with the provisions of BCP 78 and BCP 79.</p><p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF), its areas, and its working groups. Note that other groups may also distribute working documents as Internet-Drafts.</p><p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time. It is inappropriate to use Internet-Drafts as reference material or to cite them other than as &#8220;work in progress&#8221;.</p><p>The list of current Internet-Drafts can be accessed at &lt;<a href="http://www.ietf.org/ietf/1id-abstracts.txt">http://www.ietf.org/ietf/1id-abstracts.txt</a>&gt;.</p><p>The list of Internet-Draft Shadow Directories can be accessed at &lt;<a href="http://www.ietf.org/shadow.html">http://www.ietf.org/shadow.html</a>&gt;.</p><p>This Internet-Draft will expire in February 6, 2011.</p><h1><a id="rfc.copyrightnotice" href="#rfc.copyrightnotice">Copyright Notice</a></h1><p>Copyright © 2010 IETF Trust and the persons identified as the document authors. All rights reserved.</p><p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of publication of this document. Please review these documents carefully, as they describe your rights and restrictions with respect to this document. Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the BSD License.</p><hr class="noprint"><h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1><ul class="toc"><li class="tocline0">1.&nbsp;&nbsp;&nbsp;<a href="#rfc.section.1">Introduction</a></li><li class="tocline0">2.&nbsp;&nbsp;&nbsp;<a href="#rfc.section.2">HTTP Issues Encountered</a></li><li class="tocline0">3.&nbsp;&nbsp;&nbsp;<a href="#rfc.section.3">Proposal</a></li><li class="tocline0">4.&nbsp;&nbsp;&nbsp;<a href="#rfc.section.4">What about Non-HTTP Applications and Techniques?</a></li><li class="tocline0">5.&nbsp;&nbsp;&nbsp;<a href="#rfc.section.5">Security Considerations</a></li><li class="tocline0">6.&nbsp;&nbsp;&nbsp;<a href="#rfc.section.6">IANA Considerations</a></li><li class="tocline0"><a href="#rfc.authors">Author's Address</a></li><li class="tocline0">A.&nbsp;&nbsp;&nbsp;<a href="#rfc.section.A">Acknowledgements</a></li></ul><h1 id="rfc.section.1" class="np"><a href="#rfc.section.1">1.</a>&nbsp;Introduction</h1><p id="rfc.section.1.p.1">It has become common for networks to require authentication, payment and/or acceptance of terms of service before granting access. Typically, this occurs when accessing "public" networks such as those in hotels, trains, conference centres and similar networks.</p><p id="rfc.section.1.p.2">While there are several potential means of providing credentials to a network, these are not yet universally supported, and in some instances the network administrator requires that information (e.g., terms of service, login information) be displayed to end users.</p><p id="rfc.section.1.p.3">In such cases, it has become widespread practice to use a "captive portal" that diverts HTTP requests to the administrator's web page. Once the user has satisfied requirements (e.g., for payment, acceptance of terms), the diversion is ended and "normal" access to the network is allowed.</p><p id="rfc.section.1.p.4">Typically, this diversion is accomplished by one of several possible techniques; </p><ul><li>IP interception - all requests on port 80 are intercepted and send to the portal.</li><li>HTTP redirects - all requests on port 80 are intercepted and an HTTP redirect to the portal's URL is returned.</li><li>DNS interception - all DNS lookups return the portal's IP address.</li></ul><p id="rfc.section.1.p.5">In each case, the intent is that users connecting to the network will open a Web browser and see the portal.</p><p id="rfc.section.1.p.6">This memo examines the HTTP-related issues that these techniques raise, and proposes a potential mitigation strategy.</p><h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a>&nbsp;HTTP Issues Encountered</h1><p id="rfc.section.2.p.1">Since clients cannot differentiate between a portal's response and that of the HTTP server that they intended to communicate with, a number of issues arise.</p><p id="rfc.section.2.p.2">One example is the "favicon.ico" &lt;<a href="http://en.wikipedia.org/wiki/Favicon">http://en.wikipedia.org/wiki/Favicon</a>&gt; commonly used by browsers to identify the site being accessed. If the favicon for a given site is fetched from a captive portal instead of the intended site (e.g., because the user is unauthenticated), it will often "stick" in the browser's cache (most implementations cache favicons aggressively) beyond the portal session, so that it seems as if the portal's favicon has "taken over" the legitimate site.</p><p id="rfc.section.2.p.3">Another browser-based issue comes about when P3P &lt;<a href="http://www.w3.org/TR/P3P/">http://www.w3.org/TR/P3P/</a>&gt; is supported. Depending on how it is implemented, it's possible a browser might interpret a portal's response for the p3p.xml file as the server's, resulting in the privacy policy (or lack thereof) advertised by the portal being interpreted as applying to the intended site. Other Web-based protocols such as WebFinger &lt;<a href="http://code.google.com/p/webfinger/wiki/WebFingerProtocol">http://code.google.com/p/webfinger/wiki/WebFingerProtocol</a>&gt;, CORS &lt;<a href="http://www.w3.org/TR/cors/">http://www.w3.org/TR/cors/</a>&gt; and OAuth &lt;<a href="http://tools.ietf.org/html/draft-ietf-oauth-v2">http://tools.ietf.org/html/draft-ietf-oauth-v2</a>&gt; may also be vulnerable to such issues.</p><p id="rfc.section.2.p.4">Although HTTP is most widely used with Web browsers, a growing number of non-browsing applications use it as a substrate protocol. For example, WebDAV &lt;<a href="http://tools.ietf.org/html/rfc4918">http://tools.ietf.org/html/rfc4918</a>&gt; and CalDAV &lt;<a href="http://www.ietf.org/rfc/rfc4791.txt">http://www.ietf.org/rfc/rfc4791.txt</a>&gt; both use HTTP as the basis (for network filesystem access and calendaring, respectively). Using these applications from behind a captive portal can result in spurious errors being presented to the user, and might result in content corruption, in extreme cases.</p><p id="rfc.section.2.p.5">Similarly, other non-browser applications using HTTP can be affected as well; e.g., widgets &lt;<a href="http://www.w3.org/TR/widgets/">http://www.w3.org/TR/widgets/</a>&gt;, software updates, and other specialised software such as Twitter clients and the iTunes Music Store.</p><p id="rfc.section.2.p.6">It should be noted that it's sometimes believed that using HTTP redirection to direct traffic to the portal addresses these issues. However, since many of these uses "follow" redirects, this is not a good solution.</p><h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a>&nbsp;Proposal</h1><p id="rfc.section.3.p.1">The heart of the issues seen is that the client doesn't understand that a response from the portal does not represent the requested resource.</p><p id="rfc.section.3.p.2">As such, the response needs to indicate that it is non-authoritative.</p><p id="rfc.section.3.p.3">In HTTP, response status codes indicate the type of response, and therefore defining a new one is the most appropriate way to do this. Status codes are divided into general classes; </p><dl class="empty"><dd>1xx - Informational</dd><dd>2xx - Successful</dd><dd>3xx - Redirection</dd><dd>4xx - Client errors</dd><dd>5xx - Server errors</dd></dl><p id="rfc.section.3.p.4">Although it's common for captive portals to use redirection status codes, defining a new 3xx code for them isn't practical; current implementations won't recognise the new status code, and therefore won't follow it.</p><p id="rfc.section.3.p.5">Error status codes, on the other hand, have a nice property in that browsers will generally display the response content if they don't understand the status code. The one exception to this is Internet Explorer, which will display a "friendly" message if the response body is too small; however, this is easy enough to work around, by padding the response message as necessary.</p><p id="rfc.section.3.p.6">HTTP defines 4xx status codes as those where the error lies in the client; i.e., the client shouldn't retry the same request without changing something. This is arguably more appropriate than using a 5xx error, where the error is said to lie in the server's area of responsibility, because clients might automatically retry a request upon seeing a 5xx error.</p><p id="rfc.section.3.p.7">In fact, there's already an existing status code with similar (but not quite suitable) semantics; 407 Proxy Authentication Required. What's needed is a new status code with the semantics of "Network Authentication Required."</p><p id="rfc.section.3.p.8">As such, this memo proposes (but does not yet define) using a new HTTP response status code in the 4xx range with the semantics "Network Authentication Required" to mitigate the risks of captive portals.</p><p id="rfc.section.3.p.9">Captive portals that deploy this status code will return it for all requests other than those to the actual portal resources (e.g., images). Clients that are unaware of the specific semantics of the new status code will fall back to treating it as a generic 400 error, and browsers will display the portal page to users.</p><p id="rfc.section.3.p.10">Note that this would make the HTTP redirection technique described above obsolete; the portal page would be served directly with the new status code.</p><h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a>&nbsp;What about Non-HTTP Applications and Techniques?</h1><p id="rfc.section.4.p.1">This memo does not address non-HTTP applications, such as IMAP, POP, or even TLS-encapsulated HTTP. Since captive portals almost always target Web browsers (has anyone ever seen one that inserts an e-mail into your inbox asking you to authenticate?), this is appropriate.</p><p id="rfc.section.4.p.2">Instead, it is anticipated that well-behaved portals will block all non-HTTP ports (especially port 443) until the user has successfully authenticated.</p><p id="rfc.section.4.p.3">Overall, there may also be an interesting discussion to be had about improving network access methods to the point where a user interface can be presented for the same purposes, without resorting to intercepting HTTP traffic. However, since such a mechanism would by necessity require modifying the network stack and operating system of the client, this memo takes a more modest approach.</p><h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a>&nbsp;Security Considerations</h1><p id="rfc.section.5.p.1">This memo does not (yet) define any protocol elements, and therefore does not (yet) have any security considerations.</p><h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a>&nbsp;IANA Considerations</h1><p id="rfc.section.6.p.1">This document has no actions for IANA.</p><div class="avoidbreak"><h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1><address class="vcard"><span class="vcardline"><span class="fn">Mark Nottingham</span><span class="n hidden"><span class="family-name">Nottingham</span><span class="given-name">Mark</span></span></span><span class="vcardline">EMail: <a href="mailto:mnot@mnot.net"><span class="email">mnot@mnot.net</span></a></span><span class="vcardline">URI: <a href="http://www.mnot.net/" class="url">http://www.mnot.net/</a></span></address></div><h1 id="rfc.section.A" class="np"><a href="#rfc.section.A">A.</a>&nbsp;Acknowledgements</h1><p id="rfc.section.A.p.1">The author takes all responsibility for errors and omissions.</p></body></html>