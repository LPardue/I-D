<?xml version="1.0" encoding="UTF-8"?>
  <?xml-stylesheet type="text/xsl" href="rfc2629.xslt" ?>
  <!-- generated by https://github.com/cabo/kramdown-rfc2629 version 1.0.30 -->

<!DOCTYPE rfc SYSTEM "../Tools/rfc2629xslt/rfc2629.dtd" [
]>

<?rfc toc="yes"?>
<?rfc tocindent="yes"?>
<?rfc sortrefs="yes"?>
<?rfc symrefs="yes"?>
<?rfc strict="yes"?>
<?rfc compact="yes"?>
<?rfc comments="yes"?>
<?rfc inline="yes"?>

<rfc ipr="trust200902" docName="draft-nottingham-site-wide-headers-00" category="info">

  <front>
    <title>Site-Wide HTTP Headers</title>

    <author initials="M." surname="Nottingham" fullname="Mark Nottingham">
      <organization></organization>
      <address>
        <email>mnot@mnot.net</email>
        <uri>http://www.mnot.net/</uri>
      </address>
    </author>

    <date year="2016"/>

    <area>General</area>
    
    <keyword>Internet-Draft</keyword>

    <abstract>


<t>This document specifies a mechanism for Web sites to send HTTP header fields that apply to the entire origin via a different, more efficient mechanism, rather than including them in every response.</t>



    </abstract>


  </front>

  <middle>


<section anchor="introduction" title="Introduction">

<t>A variety of metadata about Web sites is being conveyed in new HTTP response headers. In particular, it is becoming more common for metadata that applies to an entire Web site to be conveyed in a header field that is included on every response for that site.</t>

<t>For example, <spanx style="verb">Strict-Transport-Security</spanx> <xref target="RFC6797"/> and <spanx style="verb">Public-Key-Pins</spanx> <xref target="RFC7469"/> both define headers that are explicitly scoped to an entire origin <xref target="RFC6454"/>, and number of similar headers are under consideration.</t>

<t>Likewise, some HTTP header fields only sensibly have a single value per origin; for example, <spanx style="verb">Server</spanx>.</t>

<t>Furthermore, some headers are resource-specific, but in some deployments, are uniform across an origin. For example, some sites will have a <spanx style="verb">CSP</spanx> <xref target="W3C.CR-CSP2-20150721"/> header that doesn’t vary across the site.</t>

<t>This is inefficient. Besides the obvious bandwidth waste due to redundancy in HTTP/1, it also impacts HTTP/2’s HPACK <xref target="RFC7541"/> header compression; since the amount of space of available for state is limited (by default, 4K), verbose, repeating headers can greatly reduce the effectiveness of HPACK.</t>

<t>However, when the metadata affects processing of the response, and the application is latency-sensitive (as uses of HTTP so often are), it’s not pratical to separate the metadata from the response; it needs to be sent on every response so that it is available.</t>

<t>One way to mitigate this problem is to remove these site-wide header fields from responses, and keep them in a separate resource. When clients have fetched that resource and guarantee that they will consider its contents to be included in all responses for that domain, they can indicate this to the server with a small request header; when servers see it, they can safely omit those headers in responses.</t>

<t>In this manner, such headers are sent on responses until they are loaded from a separate resource; once the client indicates it has done so, they can be omitted from responses, reducing network and compression context usage.</t>

<t>This document specifies how to do this by using a well-known URI <xref target="RFC5785"/> to store these headers in a format specified in <xref target="type"/>. In typical use, a server can use HTTP/2 Server Push (<xref target="RFC7540"/>, Section 8.2) to proactively send this content upon the first request from the client. Then, it can add the headers therein to responses when the corresponding requests do not contain the <spanx style="verb">SM</spanx> header field.</t>

<section anchor="notational-conventions" title="Notational Conventions">

<t>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
“RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in
<xref target="RFC2119"/>.</t>

</section>
</section>
<section anchor="site-wide" title="Site-Wide HTTP Headers">

<t>When a server wishes to use site-wide HTTP headers, it places a file in the <spanx style="verb">text/http-headers</spanx> format (<xref target="type"/>) at the <spanx style="verb">site-headers</spanx> well-known URI (<xref target="well-known"/>).</t>

<t>Then, when requests have a <spanx style="verb">SM</spanx> request header field <xref target="sm"/>, the header field values within are omitted from the corresponding responses. Typically, this can be implemented by appending the headers contained therein when the request doesn’t contain the SM header field.</t>

<t>Servers SHOULD include <spanx style="verb">SM</spanx> in the field-value of the Vary response header field when the response is cacheable (as per <xref target="RFC7234"/>).</t>

<t>For example, if a request to the well-known URI returns:</t>

<figure><artwork><![CDATA[
HTTP/1.1 200 OK
Content-Type: text/http-headers
Cache-Control: max-age=3600
Content-Length: 334

Strict-Transport-Security: max-age=15768000 ; includeSubDomains
Server: Apache/2.4.7 (Ubuntu)
Public-Key-Pins: max-age=604800; 
  pin-sha256="ZitlqPmA9wodcxkwOW/c7ehlNFk8qJ9FsocodG6GzdjNM=";
  pin-sha256="XRXP987nz4rd1/gS2fJSNVfyrZbqa00T7PeRXUPd15w="; 
  report-uri="/lib/key-pin.cgi"
Cache-Control: max-age=3600
Vary: Accept-Encoding
]]></artwork></figure>

<t>and a client that has loaded that resource makes the request:</t>

<figure><artwork><![CDATA[
GET /images/foo.jpg HTTP/1.1
Host: www.example.com
SM: 1
]]></artwork></figure>

<t>this indicates that the client has processed the site-metatadata resource, and therefore that the server can omit the response header fields contained within it on the wire:</t>

<figure><artwork><![CDATA[
HTTP/1.1 200 OK
Content-Type: image/jpeg
Vary: SM
Transfer-Encoding: chunked
]]></artwork></figure>

<t>Upon receipt of that response, the client will consider it equivalent to:</t>

<figure><artwork><![CDATA[
HTTP/1.1 200 OK
Content-Type: image/jpeg
Vary: SM
Connection: close
Strict-Transport-Security: max-age=15768000 ; includeSubDomains
Server: Apache/2.4.7 (Ubuntu)
Public-Key-Pins: max-age=604800; 
  pin-sha256="ZitlqPmA9wodcxkwOW/c7ehlNFk8qJ9FsocodG6GzdjNM=";
  pin-sha256="XRXP987nz4rd1/gS2fJSNVfyrZbqa00T7PeRXUPd15w="; 
  report-uri="/lib/key-pin.cgi"
Cache-Control: max-age=3600
Vary: Accept-Encoding
]]></artwork></figure>

<t>If a request omits the <spanx style="verb">SM</spanx> header field, all of the header fields above will be sent by the server in the response.</t>

<t>Note that in these examples, the <spanx style="verb">Vary</spanx> header field has two values. Because the field values in the well-known resource are appended to the header set occurring on the wire, clients will combine them as per the rules in <xref target="RFC7230"/>, Section 3.2.2.</t>

<section anchor="type" title="The “text/http-headers” Media Type">

<t>The text/http-headers media type is used to indicate that a file contains a set of HTTP header fields, as defined in <xref target="RFC7230"/>, Section 3; i.e.,</t>

<figure><artwork><![CDATA[
OWS *( header-field CRLF ) OWS
]]></artwork></figure>

<t>Whitespace at the beginning and end of the file MUST be stripped. As in HTTP itself, implementations need to be forgiving about line endings; specifically, bare CR MUST be considered to be a line ending.</t>

<t>For example:</t>

<figure><artwork><![CDATA[
Strict-Transport-Security: max-age=15768000 ; includeSubDomains
Server: Apache/2.4.7 (Ubuntu)
Public-Key-Pins: max-age=604800;
  pin-sha256="ZitlqPmA9wodcxkwOW/c7ehlNFk8qJ9FsocodG6GzdjNM=";
  pin-sha256="XRXP987nz4rd1/gS2fJSNVfyrZbqa00T7PeRXUPd15w="; 
  report-uri="/lib/key-pin.cgi"
Cache-Control: max-age=3600
Vary: Accept-Encoding
]]></artwork></figure>

</section>
<section anchor="well-known" title="The “site-metadata” well-known URI">

<t>The well-known URI <xref target="RFC5785"/> “site-metadata” is a resource that, when fetched, returns a file in the “text/http-headers” <xref target="type"/> format.</t>

<t>Its media type SHOULD be generated as <spanx style="verb">text/http-headers</spanx>, although clients SHOULD NOT reject responses with other types (particularly, <spanx style="verb">application/octet-stream</spanx> and <spanx style="verb">text/plain</spanx>).</t>

<t>Clients SHOULD consider it to be valid for its freshness lifetime (as per <xref target="RFC7234"/>). If it does not have an explicit freshness lifetime, they SHOULD consider it to have a heuristic freshness lifetime of 60 seconds.</t>

</section>
<section anchor="sm" title="The “SM” HTTP Request Header Field">

<t>The “SM” HTTP request header field indicates that the client has a fresh (as per <xref target="RFC7234"/>) copy of the “site-metadata” URI <xref target="well-known"/> for the request’s origin (<xref target="RFC6454"/>), and will consider the corresponding response to contain the header field(s) contained within.</t>

<t>Clients MUST generate its field value as “1”.</t>

<t>For example:</t>

<figure><artwork><![CDATA[
SM: 1
]]></artwork></figure>

<t>Servers MUST consider it to be present when the field name <spanx style="verb">SM</spanx> is present in the set of request header fields; i.e., the value is not relevant.</t>

</section>
</section>
<section anchor="iana-considerations" title="IANA Considerations">

<t>TBD</t>

</section>
<section anchor="security-considerations" title="Security Considerations">

<section anchor="combining-headers" title="Combining Headers">

</section>
</section>


  </middle>

  <back>

    <references title='Normative References'>





<reference  anchor='RFC2119' target='http://www.rfc-editor.org/info/rfc2119'>
<front>
<title>Key words for use in RFCs to Indicate Requirement Levels</title>
<author initials='S.' surname='Bradner' fullname='S. Bradner'><organization /></author>
<date year='1997' month='March' />
<abstract><t>In many standards track documents several words are used to signify the requirements in the specification.  These words are often capitalized. This document defines these words as they should be interpreted in IETF documents.  This document specifies an Internet Best Current Practices for the Internet Community, and requests discussion and suggestions for improvements.</t></abstract>
</front>
<seriesInfo name='BCP' value='14'/>
<seriesInfo name='RFC' value='2119'/>
<seriesInfo name='DOI' value='10.17487/RFC2119'/>
</reference>



<reference  anchor='RFC6454' target='http://www.rfc-editor.org/info/rfc6454'>
<front>
<title>The Web Origin Concept</title>
<author initials='A.' surname='Barth' fullname='A. Barth'><organization /></author>
<date year='2011' month='December' />
<abstract><t>This document defines the concept of an &quot;origin&quot;, which is often used as the scope of authority or privilege by user agents.  Typically, user agents isolate content retrieved from different origins to prevent malicious web site operators from interfering with the operation of benign web sites.  In addition to outlining the principles that underlie the concept of origin, this document details how to determine the origin of a URI and how to serialize an origin into a string.  It also defines an HTTP header field, named &quot;Origin&quot;, that indicates which origins are associated with an HTTP request.   [STANDARDS-TRACK]</t></abstract>
</front>
<seriesInfo name='RFC' value='6454'/>
<seriesInfo name='DOI' value='10.17487/RFC6454'/>
</reference>



<reference  anchor='RFC5785' target='http://www.rfc-editor.org/info/rfc5785'>
<front>
<title>Defining Well-Known Uniform Resource Identifiers (URIs)</title>
<author initials='M.' surname='Nottingham' fullname='M. Nottingham'><organization /></author>
<author initials='E.' surname='Hammer-Lahav' fullname='E. Hammer-Lahav'><organization /></author>
<date year='2010' month='April' />
<abstract><t>This memo defines a path prefix for &quot;well-known locations&quot;, &quot;/.well-known/&quot;, in selected Uniform Resource Identifier (URI) schemes.   [STANDARDS-TRACK]</t></abstract>
</front>
<seriesInfo name='RFC' value='5785'/>
<seriesInfo name='DOI' value='10.17487/RFC5785'/>
</reference>



<reference  anchor='RFC7540' target='http://www.rfc-editor.org/info/rfc7540'>
<front>
<title>Hypertext Transfer Protocol Version 2 (HTTP/2)</title>
<author initials='M.' surname='Belshe' fullname='M. Belshe'><organization /></author>
<author initials='R.' surname='Peon' fullname='R. Peon'><organization /></author>
<author initials='M.' surname='Thomson' fullname='M. Thomson' role='editor'><organization /></author>
<date year='2015' month='May' />
<abstract><t>This specification describes an optimized expression of the semantics of the Hypertext Transfer Protocol (HTTP), referred to as HTTP version 2 (HTTP/2).  HTTP/2 enables a more efficient use of network resources and a reduced perception of latency by introducing header field compression and allowing multiple concurrent exchanges on the same connection.  It also introduces unsolicited push of representations from servers to clients.</t><t>This specification is an alternative to, but does not obsolete, the HTTP/1.1 message syntax.  HTTP's existing semantics remain unchanged.</t></abstract>
</front>
<seriesInfo name='RFC' value='7540'/>
<seriesInfo name='DOI' value='10.17487/RFC7540'/>
</reference>



<reference  anchor='RFC7234' target='http://www.rfc-editor.org/info/rfc7234'>
<front>
<title>Hypertext Transfer Protocol (HTTP/1.1): Caching</title>
<author initials='R.' surname='Fielding' fullname='R. Fielding' role='editor'><organization /></author>
<author initials='M.' surname='Nottingham' fullname='M. Nottingham' role='editor'><organization /></author>
<author initials='J.' surname='Reschke' fullname='J. Reschke' role='editor'><organization /></author>
<date year='2014' month='June' />
<abstract><t>The Hypertext Transfer Protocol (HTTP) is a stateless \%application- level protocol for distributed, collaborative, hypertext information systems.  This document defines HTTP caches and the associated header fields that control cache behavior or indicate cacheable response messages.</t></abstract>
</front>
<seriesInfo name='RFC' value='7234'/>
<seriesInfo name='DOI' value='10.17487/RFC7234'/>
</reference>



<reference  anchor='RFC7230' target='http://www.rfc-editor.org/info/rfc7230'>
<front>
<title>Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing</title>
<author initials='R.' surname='Fielding' fullname='R. Fielding' role='editor'><organization /></author>
<author initials='J.' surname='Reschke' fullname='J. Reschke' role='editor'><organization /></author>
<date year='2014' month='June' />
<abstract><t>The Hypertext Transfer Protocol (HTTP) is a stateless application-level protocol for distributed, collaborative, hypertext information systems.  This document provides an overview of HTTP architecture and its associated terminology, defines the &quot;http&quot; and &quot;https&quot; Uniform Resource Identifier (URI) schemes, defines the HTTP/1.1 message syntax and parsing requirements, and describes related security concerns for implementations.</t></abstract>
</front>
<seriesInfo name='RFC' value='7230'/>
<seriesInfo name='DOI' value='10.17487/RFC7230'/>
</reference>




    </references>

    <references title='Informative References'>





<reference  anchor='RFC6797' target='http://www.rfc-editor.org/info/rfc6797'>
<front>
<title>HTTP Strict Transport Security (HSTS)</title>
<author initials='J.' surname='Hodges' fullname='J. Hodges'><organization /></author>
<author initials='C.' surname='Jackson' fullname='C. Jackson'><organization /></author>
<author initials='A.' surname='Barth' fullname='A. Barth'><organization /></author>
<date year='2012' month='November' />
<abstract><t>This specification defines a mechanism enabling web sites to declare themselves accessible only via secure connections and/or for users to be able to direct their user agent(s) to interact with given sites only over secure connections.  This overall policy is referred to as HTTP Strict Transport Security (HSTS).  The policy is declared by web sites via the Strict-Transport-Security HTTP response header field and/or by other means, such as user agent configuration, for example. [STANDARDS-TRACK]</t></abstract>
</front>
<seriesInfo name='RFC' value='6797'/>
<seriesInfo name='DOI' value='10.17487/RFC6797'/>
</reference>



<reference  anchor='RFC7469' target='http://www.rfc-editor.org/info/rfc7469'>
<front>
<title>Public Key Pinning Extension for HTTP</title>
<author initials='C.' surname='Evans' fullname='C. Evans'><organization /></author>
<author initials='C.' surname='Palmer' fullname='C. Palmer'><organization /></author>
<author initials='R.' surname='Sleevi' fullname='R. Sleevi'><organization /></author>
<date year='2015' month='April' />
<abstract><t>This document defines a new HTTP header that allows web host operators to instruct user agents to remember (&quot;pin&quot;) the hosts' cryptographic identities over a period of time.  During that time, user agents (UAs) will require that the host presents a certificate chain including at least one Subject Public Key Info structure whose fingerprint matches one of the pinned fingerprints for that host.  By effectively reducing the number of trusted authorities who can authenticate the domain during the lifetime of the pin, pinning may reduce the incidence of man-in-the-middle attacks due to compromised Certification Authorities.</t></abstract>
</front>
<seriesInfo name='RFC' value='7469'/>
<seriesInfo name='DOI' value='10.17487/RFC7469'/>
</reference>



<reference anchor='W3C.CR-CSP2-20150721'
           target='http://www.w3.org/TR/2015/CR-CSP2-20150721'>
<front>
<title>Content Security Policy Level 2</title>

<author initials='M.' surname='West' fullname='Mike West'>
    <organization />
</author>

<author initials='A.' surname='Barth' fullname='Adam Barth'>
    <organization />
</author>

<author initials='D.' surname='Veditz' fullname='Daniel Veditz'>
    <organization />
</author>

<date month='July' day='21' year='2015' />
</front>

<seriesInfo name='World Wide Web Consortium CR' value='CR-CSP2-20150721' />
<format type='HTML' target='http://www.w3.org/TR/2015/CR-CSP2-20150721' />
</reference>



<reference  anchor='RFC7541' target='http://www.rfc-editor.org/info/rfc7541'>
<front>
<title>HPACK: Header Compression for HTTP/2</title>
<author initials='R.' surname='Peon' fullname='R. Peon'><organization /></author>
<author initials='H.' surname='Ruellan' fullname='H. Ruellan'><organization /></author>
<date year='2015' month='May' />
<abstract><t>This specification defines HPACK, a compression format for efficiently representing HTTP header fields, to be used in HTTP/2.</t></abstract>
</front>
<seriesInfo name='RFC' value='7541'/>
<seriesInfo name='DOI' value='10.17487/RFC7541'/>
</reference>




    </references>



  </back>
</rfc>

